<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Writer AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="p-8">
            <h1 class="text-2xl font-bold mb-4">üéµ Song Writer AI ü§ñ</h1>
            
            <div id="initialForm">
                <input type="text" id="themeInput" placeholder="Enter a theme for your song" class="w-full p-2 border rounded mb-4">
                <button id="generateButton" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Write Initial Draft</button>
            </div>
            
            <div id="refinementForm" class="hidden">
                <input type="text" id="lyricsRefinement" placeholder="Lyrics refinement (e.g., Make it more upbeat)" class="w-full p-2 border rounded mb-4">
                <input type="text" id="melodyAdjustment" placeholder="Melody adjustment (e.g., Add more rhythm)" class="w-full p-2 border rounded mb-4">
                <button id="refineButton" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Refine Song</button>
            </div>
            
            <div id="output" class="mt-4 p-4 bg-gray-100 rounded"></div>
        </div>
    </div>

    <script>
        const initialForm = document.getElementById('initialForm');
        const refinementForm = document.getElementById('refinementForm');
        const generateButton = document.getElementById('generateButton');
        const refineButton = document.getElementById('refineButton');
        const themeInput = document.getElementById('themeInput');
        const lyricsRefinement = document.getElementById('lyricsRefinement');
        const melodyAdjustment = document.getElementById('melodyAdjustment');
        const output = document.getElementById('output');

        generateButton.addEventListener('click', async () => {
            const theme = themeInput.value;
            
            output.innerHTML = `<p>üé® Starting to write a song about "${theme}"...</p>`;

            try {
                const response = await fetch('/write_initial_draft', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ theme }),
                });

                if (!response.ok) {
                    throw new Error('Something went wrong');
                }

                const data = await response.json();

                output.innerHTML += `
                    <p class="mt-4"><strong>üìù Initial Lyrics:</strong></p>
                    <pre class="whitespace-pre-wrap">${data.lyrics || 'No lyrics generated'}</pre>
                    <p class="mt-4"><strong>üéµ Initial Melody:</strong></p>
                    <pre class="whitespace-pre-wrap">${data.melody || 'No melody generated'}</pre>
                `;

                initialForm.classList.add('hidden');
                refinementForm.classList.remove('hidden');
            } catch (error) {
                output.innerHTML += `<p class="text-red-500">Oops! Something went wrong: ${error.message}</p>`;
            }
        });

        refineButton.addEventListener('click', async () => {
            const theme = themeInput.value;
            const lyricsRefine = lyricsRefinement.value || "Make it more upbeat";
            const melodyAdjust = melodyAdjustment.value || "Add more rhythm";
            
            output.innerHTML += `<p>üîÑ Refining the song...</p>`;

            try {
                const response = await fetch('/refine_song', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ theme, lyricsRefine, melodyAdjust }),
                });

                if (!response.ok) {
                    throw new Error('Something went wrong');
                }

                const data = await response.json();

                output.innerHTML += `
                    <p class="mt-4"><strong>üìù Refined Lyrics:</strong></p>
                    <pre class="whitespace-pre-wrap">${data.lyrics || 'No lyrics generated'}</pre>
                    <p class="mt-4"><strong>üéµ Refined Melody:</strong></p>
                    <pre class="whitespace-pre-wrap">${data.melody || 'No melody generated'}</pre>
                `;
            } catch (error) {
                output.innerHTML += `<p class="text-red-500">Oops! Something went wrong: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>