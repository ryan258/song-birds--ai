<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽµ Song Writer AI ðŸ¤–</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="max-w-4xl mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6 text-center">ðŸŽµ Song Writer AI ðŸ¤–</h1>

        <!-- This is where we write a new song -->
        <div id="initialForm" class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Write Initial Draft</h2>
            <input type="text" id="theme" placeholder="Enter a theme for your song" class="w-full p-2 border rounded mb-4">
            <button onclick="writeInitialDraft()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Generate Song</button>
        </div>

        <!-- This is where we make the song better -->
        <div id="refinementForm" class="bg-white rounded-xl shadow-md p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Refine Song</h2>
            <textarea id="lyricsFeedback" placeholder="Feedback for the lyrics" class="w-full p-2 border rounded mb-2" rows="3"></textarea>
            <input type="text" id="styleFeedback" placeholder="Feedback for the style description" class="w-full p-2 border rounded mb-4">
            <button onclick="refineSong()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Refine Song</button>
        </div>

        <!-- This is where we show the songs -->
        <div id="output" class="space-y-6"></div>
    </div>

    <script>
        let currentSong = null;

        // This makes a new song
        async function writeInitialDraft() {
            const theme = document.getElementById('theme').value;
            const response = await fetch('/write_initial_draft', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ theme }),
            });
            const song = await response.json();
            displaySong(song);
            document.getElementById('refinementForm').classList.remove('hidden');
        }

        // This makes the song better
        async function refineSong() {
            const lyricsFeedback = document.getElementById('lyricsFeedback').value;
            const styleFeedback = document.getElementById('styleFeedback').value;
            const response = await fetch('/refine_song', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    lyricsFeedback, 
                    styleFeedback 
                }),
            });
            const song = await response.json();
            displaySong(song);
        }

        // This shows the song on the page
        function displaySong(song) {
            currentSong = song;
            const outputDiv = document.getElementById('output');
            const songDiv = document.createElement('div');
            songDiv.className = 'bg-white rounded-xl shadow-md p-6';
            songDiv.innerHTML = `
                <p class="text-sm text-gray-600 mb-4">${escapeHtml(song.style_description)}</p>
                <pre class="whitespace-pre-wrap mb-4">${escapeHtml(song.lyrics)}</pre>
                <div class="flex space-x-2">
                    <button onclick="copyToClipboard('lyrics')" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300">Copy Lyrics</button>
                    <button onclick="copyToClipboard('style')" class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300">Copy Style</button>
                </div>
            `;
            outputDiv.insertBefore(songDiv, outputDiv.firstChild);
        }

        // This copies the lyrics or style to your computer's clipboard
        function copyToClipboard(type) {
            if (!currentSong) {
                alert('No song available to copy!');
                return;
            }

            let textToCopy = type === 'lyrics' ? currentSong.lyrics : currentSong.style_description;

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert(`${type.charAt(0).toUpperCase() + type.slice(1)} copied to clipboard!`);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy text. See console for details.');
            });
        }

        // This makes sure special characters show up correctly
        function escapeHtml(unsafe) {
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>